---
title: <span style="color:#fe6e87;">Deworm the World Initiative-<br> Rivers State, Nigeria</span>
output: html_document
runtime: shiny
---



*A Process Monitoring and Coverage Validation report from year 6 of School-<br>Based Deworming implementation in Rivers State, Nigeria*

<span style="background-color:#fe6e87; color:white; display: inline-block; text-align: center; width: 100%;">*May and November, 2022*</span>


**Prepared by:** 	Evidence Action

**For:**                    	GiveWell and partners, Nigerian Ministries of Health and Education

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE
)
```


```{r importing packages}
library(shiny)
library(knitr)
library(ggplot2)
library(dplyr)
library(kableExtra)
library(RPostgreSQL)
library(DBI)
```


```{r database_connection, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}

# import packages
library(RPostgreSQL)
library(shiny)
library(shinyjs)

# Database connection details
db_user <- "sylviagitau"
db_password <- "5y1Vi4.8|7@u"
db_host <- "pilot.cnltbg2tkrfl.eu-central-1.rds.amazonaws.com"
db_port <- 5432
db_name <- "nigeria_pmcv"

# Establish a database connection
con <- dbConnect(
  PostgreSQL(),
  user = db_user,
  password = db_password,
  host = db_host,
  port = db_port,
  dbname = db_name
)

# Close the database connection
# dbDisconnect(con)
```


### <span style="color:#fe6e87;">Table of Contents</span>

```{r toc}
contents <- c(
  "Glossary" = 3,
  "1.0 Executive Summary" = 4,
  "2.0 Background" = 6,
  "3.0 Methodology" = 7,
  "3.1 Process Monitoring" = 7,
  "3.2 Coverage Validation" = 7,
  "4.0 Process Monitoring Results" = 8,
  "4.1 Training Results" = 8,
  "Topic coverage" = 10,
  "Topic 1: Health Education" = 10,
  "Topic 2: Target Population" = 11,
  "Topic 3: Roles and Responsibilities" = 11,
  "Topic 4: Community Sensitization" = 12,
  "Topic 5: Recording and Reporting Forms" = 13,
  "Topic 6: Drug Administration" = 14,
  "Topic 7: Side Effects" = 15,
  "Training Logistics" = 17,
  "4.2 Distribution of Drugs and Materials" = 17,
  "4.3 Community Sensitization" = 18,
  "4.4 Deworming Week" = 23,
  "5.0 Coverage Validation Results" = 25,
  "5.1 STH Results" = 25,
  "5.2 Reasons Drugs Were Not Provided and Non-compliance" = 26,
  "5.3 Unprogrammed Deworming" = 27,
  "6.0 Priorities and Way Forward" = 28
)

# Create a data frame from the vector
toc_df <- data.frame(Content = names(contents), Page = unname(contents))


# Print the table of contents
kable(toc_df, "html") %>%
  kable_styling()

```

### <span style="color:#fe6e87;">Glossary</span>

```{r glossary}
library(kableExtra)

# Define your glossary or abbreviations
glossary <- data.frame(
  Abbreviation = c("**FLHF**  ", "**IEC**  ", "**LGA**  ", "**MDA**  ", "**PPE**  ", "**PPES**  ", "**SAE**  ", "**SBDP**  ", "**STH**  ", "**WHO**  "),
  Definition = c("Frontline Health Facility", "Information, Education and Communication",
                 "Local Government Area", "Mass Drug Administration",
                 "Personal Protective Equipment", "Probability Proportionate to Estimated Size",
                 "Severe Adverse Events", "School-Based Deworming Program",
                 "Soil-Transmitted Helminths", "World Health Organization")
)

# Print the glossary table with space between rows
kable(glossary, col.names = NULL) %>%
  kable_styling() %>%
  row_spec(1:nrow(glossary), extra_css = "margin-bottom: 10px;")
```


## <span style="color:#fe6e87;">1.0 Executive Summary</span>


This report summarizes the results of two rounds of process monitoring during the May and November 2022 deworming rounds and one coverage validation (PMCV)  exercise following the first round of deworming in Rivers State, Nigeria. As a technical assistance partner to the Government of Rivers State, Evidence Action supports PMCV to determine what worked well and identify existing challenges within the implementation process and assess the accuracy of the reported government treatment data in select local government authorities (LGAs).
 In 2022, Rivers carried out its sixth year of school-based deworming targeting both enrolled  and non-enrolled school-age children (SAC), 5-14 years. 
In total, 1.88 million  SAC were targeted for deworming treatments across 21 endemic LGAs for soil-transmitted helminths (STH) and 1.64 million SAC were treated (87% government reported treatment coverage). 

#### **Coverage Validation Findings**

Coverage validation (CV) surveys were conducted within 6 weeks of round one MDA treatment within two randomly selected LGAs – Emohua and Opobo/Nkoro to evaluate the program reach and surveyed coverage. The findings indicate that 84% of SAC in Emohua and 92% in Opobo/Nkoro were offered the chance to swallow the drug (program reach), with 83% of SAC in Emohua and 91% in Opobo/Nkoro ingesting the drug (surveyed coverage).
While CV was only conducted in two LGAs, and therefore not representative of the entire state, surveyed coverage for the two LGAs was above the WHO’s recommended 75% therapeutic coverage threshold for STH, indicating that these geographic units are on track to achieving disease control. 
When comparing surveyed coverage to government-reported coverage, reported coverage for Emohua LGA was within the 95% confidence interval of the surveyed coverage. This suggests that the reporting system is working well. The reported coverage for Opobo/Nkoro LGA was outside the 95% confidence interval of the surveyed coverage. This suggests that the reporting system in this LGA is not working well. Read more on coverage validation on page 25

#### **Process Monitoring Findings**

```{r process monitoring, echo = FALSE}

sql_query <- "SELECT variable, value, Round, attibutes
FROM tt_obs
WHERE Round = 'Overall'
AND year = 2022
AND state = 'Rivers'
AND variable IN ('School attendance Rate', 'Overall coverage of information on community sensitization')"

data <- dbGetQuery(con, sql_query)

# Calculate the percentage and display the text

value_percent <- data$value[data$variable == 'School attendance Rate'] * 100

value_percent2 <- data$value[data$variable == 'Overall coverage of information on community sensitization' & data$attibutes == 'Covered Partially'] * 100

renderText(sprintf(
  "● The program saw an increase in training attendance as compared to the previous year. %.0f%% of expected school representatives attended teacher training, a 12-percentage point increase from the previous year. All seven training topics were covered in at least %.0f%% of the monitored training sessions, with health education, drug administration, target population, and reporting and recording forms covered in 100%% of training sessions. Read more on training starting on page 8.",
  value_percent,
  value_percent2
))
```



```{r part3, echo=FALSE}

sql_query <- "SELECT variable, value, Round, attibutes
              FROM ttci_prepost
              WHERE Round = 'Overall'
              AND year = 2022
              AND state = 'Rivers'
              AND (variable = '% teachers who received all key materials for for DD (Treatment forms and Mebendazole tablets)'
                   OR (variable = 'What materials did you receive during the training for conducting deworming?'
                       AND attibutes  IN ( 'Deworming medicine' , 'Treatment Data Forms')))"

data <- dbGetQuery(con, sql_query)

# Calculate the percentage and display the text

value_percent <- data$value[data$variable == '% teachers who received all key materials for for DD (Treatment forms and Mebendazole tablets)'] * 100
value_percent2 <- data$value[data$variable == 'What materials did you receive during the training for conducting deworming?' & data$attibutes == 'Deworming medicine'] * 100
value_percent3 <- data$value[data$variable == 'What materials did you receive during the training for conducting deworming?' & data$attibutes == 'Treatment Data Forms'] * 100
# Calculate the number of rows
n_rows <- nrow(data)


# Use the dynamic values in the output text
  renderText(sprintf(
    "● Following teacher training, %.0f%% of the monitored training sessions distributed all key materials (%.0f%% distributed drugs and %.0f%% distributed reporting forms) to teachers to take to their respective schools for deworming day. Direct observation at schools during the deworming week and follow-up interviews with the head teachers after the process of drug administration at the schools revealed that %.0f%% of schools had sufficient drugs to deworm all children present. Read more on drug and material distribution on page 17.",
    value_percent,
    value_percent2,
    value_percent3,
    n_rows  # Add the number of rows as a placeholder argument
  ))
```


```{r part4, echo=FALSE}

sql_query <- "SELECT * FROM cms
WHERE year = 2022
AND state = 'Rivers'
AND round = 'Overall'
AND (
    variable = 'Proportion of parents who were aware of deworming activity at school'
    OR (
        variable = 'Is child enrolled in school?'
        OR (
            variable = 'Why will/did your children NOT get deworming medicine today?'
            AND (attributes = 'Not aware of the deworming' OR attributes = 'Child is not enrolled')
        )
        OR (
            variable = 'ASK: How did you hear about the deworming exercise to be conducted in your community?'
            AND (attributes = 'My child told me' OR attributes = 'Teacher from a local school')
        )
    )
)"

data <- dbGetQuery(con, sql_query)

# Calculate the percentage and display the text
value_percent <- data$value[data$variable == 'Proportion of parents who were aware of deworming activity at school'] * 100
value_percent2 <- data$value[data$variable == 'Is child enrolled in school?'] * 100
value_percent3 <- data$value[data$variable == 'Why will/did your children NOT get deworming medicine today?' & data$attributes == 'Not aware of the deworming'] * 100
value_percent4 <- data$value[data$variable == 'Why will/did your children NOT get deworming medicine today?' & data$attributes == 'Child is not enrolled'] * 100
value_percent5 <- data$value[data$variable == 'ASK: How did you hear about the deworming exercise to be conducted in your community?' & data$attributes == 'My child told me'] * 100
value_percent6 <- data$value[data$variable == 'ASK: How did you hear about the deworming exercise to be conducted in your community?' & data$attributes == 'Teacher from a local school'] * 100

# Calculate the number of rows
n_rows <- nrow(data)

# output text
output_text2 <- sprintf(
  "● %.0f%% of parents were aware of deworming day, with this proportion higher among parents of enrolled children (%.0f%%) as compared to the parents of non-enrolled children (43%%). Seventy-six percent (76%%) of parents, a 2-percentage point decrease from the previous year, who were aware of deworming day, indicated that they would be sending their children for deworming. The main reasons cited for parents not sending children for deworming were lack of awareness (%.0f%%) and lack of school enrollment (%.0f%%). The primary sources of deworming day information cited by parents were children (%.0f%%), followed by teachers (%.0f%%). Read more about community sensitization on page 18.",
  value_percent,
  value_percent2,
  value_percent3,
  value_percent4,
  value_percent5,
  value_percent6,
  n_rows
)

renderText(output_text2)
```


```{r part5, echo=FALSE}

sql_query <- "SELECT * FROM dd_main
WHERE variable IN ('DD protocols', 'Tabs and dosage protocol')
AND year = 2022
AND round = 'Overall'
AND state = 'Rivers'
AND attributes IN ('Trnsferred names prior', 'Treatment register used', 'Children chewed MEB')"

data <- dbGetQuery(con, sql_query)

# Calculate the percentage and display the text

value_percent <- data$value[data$variable == 'Tabs and dosage protocol' & data$attributes == 'Children chewed MEB'] * 100
value_percent2 <- data$value[data$variable == 'DD protocols' & data$attributes == 'Treatment register used'] * 100
value_percent3 <- data$value[data$variable == 'DD protocols' & data$attributes == 'Trnsferred names prior'] * 100

# Calculate the number of rows
n_rows <- nrow(data)

# Use the dynamic values in the output text
  output_text3 <- sprintf(
    "●	In both rounds 1 and 2, the program saw an increase in the number of schools distributing mebendazole tablets on deworming day; 87%% of expected schools distributed tablets which is a 27-percentage point increase from the previous year. Teachers administered the correct dosage of mebendazole at %.0f%% of schools, and %.0f%% of schools utilized the treatment register. %.0f%% of teachers transferred names from the class register to the treatment register before deworming. Read more on drug administration on page 23.",
    value_percent,
    value_percent2,
    value_percent3,
    n_rows
  )
  
renderText(output_text3)
```

Table 1 below provides the round-wise breakdown of Process Monitoring and Coverage Validation results against key indicators.

##### **Table 1: Key Performance Indicators**

<!-- Table Styles -->
<style>
.custom-table {
  border-collapse: collapse;
  width: 100%;
}

.custom-table td,
.custom-table th {
  border: 1px solid #000;
  padding: 8px;
  text-align: center;
}

.custom-table th {
  background-color: #fe6e87;
}

.custom-table .bold-row th {
  font-weight: bold;
}

.custom-table .border-left th,
.custom-table .border-left td {
  border-left: 1px solid #000;
}

.custom-table .border-right th,
.custom-table .border-right td {
  border-right: 1px solid #000;
}

/* Define custom background color for specific rows */
.custom-table .process-monitoring,
.custom-table .coverage-validation {
  background-color: #fe6e87;
}
</style>

<!-- Your Table -->
<div class="custom-table">
  <table style="empty-cells: show;">
    <tr class="process-monitoring">
      <td>Process Monitoring</td>
      <td>Year 6, Round 1</td>
      <td>Year 6, Round 2</td>
      <td>Overall</td>
    </tr>
    <tr>
      <td>Target schools represented at teacher training</td>
      ```{r school_attendance, results='asis'}
      query_school_attendance <- "SELECT round, value FROM tt_obs
                                  WHERE year = 2022
                                  AND state = 'Rivers'
                                  AND variable = 'School attendance Rate'
                                  AND Round IN ('Round 1', 'Round 2', 'Overall')"
      school_attendance_data <- dbGetQuery(con, query_school_attendance)
      
      rounds <- c('Round 1', 'Round 2', 'Overall')
      
      for (i in 1:length(rounds)) {
        round_name <- rounds[i]
        index <- which(school_attendance_data$round == round_name)
        cat("<td>")
        if (length(index) > 0) {
          cat(scales::percent(school_attendance_data$value[index]), " ")
        } else {
          cat("N/A ")
        }
        cat("</td>")
      }
      ```
    </tr>
    <tr>
      <td>Target schools with adequate drugs during deworming</td>
      ```{r adequate-drugs, results='asis'}
      query_adequate_drugs <- "SELECT round, value FROM dd_main
                                  WHERE year = 2022
                                  AND state = 'Rivers'
                                  AND attributes = 'Yes'
                                  AND variable = 'ASK:Were deworming medicines sufficient for today?'
                                  AND Round IN ('Round 1', 'Round 2', 'Overall')"
      adequate_drugs_data <- dbGetQuery(con, query_adequate_drugs)
      
      rounds <- c('Round 1', 'Round 2', 'Overall')
      
      for (i in 1:length(rounds)) {
        round_name <- rounds[i]
        index <- which(adequate_drugs_data$round == round_name)
        cat("<td>")
        if (length(index) > 0) {
          cat(scales::percent(adequate_drugs_data$value[index]), " ")
        } else {
          cat("N/A ")
        }
        cat("</td>")
      }
      ```
    </tr>
    <tr>
    <td>Target school utilizing at least one awareness activity or material</td>
      ```{r awareness-activity, results='asis'}
      query_awareness_activity <- "SELECT round, SUM(value) AS total_sum FROM dd_main
                                  WHERE year = 2023
                                  AND state = 'Rivers'
                                  AND variable = '<b>DO NOT READ THIS ALOUD: </b> Check the placement of the posters and record the most appropriate answer.'
                                  AND attributes IN ('Clearly posted/visible to all', 'Hidden in a room/partially visible')
                                  AND Round IN ('Round 1', 'Round 2', 'Overall')
                                  GROUP BY Round
                                  ORDER BY CASE
                                  WHEN Round = 'Round 1' THEN 1
                                  WHEN Round = 'Round 2' THEN 2
                                  ELSE 3
                                END"
      awareness_activity_data <- dbGetQuery(con, query_awareness_activity)
      
      rounds <- c('Round 1', 'Round 2', 'Overall')
      
      for (i in 1:length(rounds)) {
        round_name <- rounds[i]
        index <- which(awareness_activity_data$round == round_name)
        cat("<td>")
        if (length(index) > 0) {
          cat(scales::percent(awareness_activity_data$total_sum[index]), " ")
        } else {
          cat("N/A ")
        }
        cat("</td>")
      }
      ```
      </tr>
   <tr>
    <td>Community members who report seeing or hearing about deworming through IEC deworming materials or word of mouth this year</td>
      ```{r hearing-deworming, results='asis'}
      query_hearing_deworming <- "SELECT round, value FROM cms
                                  WHERE year = 2023
                                  AND state = 'Rivers'
                                  AND variable = 'Proportion of parents who were aware of deworming activity at school'
                                  AND Round IN ('Round 1', 'Round 2', 'Overall')"
      hearing_deworming_data <- dbGetQuery(con, query_hearing_deworming)
      
      rounds <- c('Round 1', 'Round 2', 'Overall')
      
      for (i in 1:length(rounds)) {
        round_name <- rounds[i]
        index <- which(hearing_deworming_data$round == round_name)
        cat("<td>")
        if (length(index) > 0) {
          cat(scales::percent(hearing_deworming_data$value[index]), " ")
        } else {
          cat("N/A ")
        }
        cat("</td>")
      }
      ```
      </tr>
    <tr>
      <td>Target schools distributing tablets on deworming day</td>
      <td>100%</td>
      <td>87%</td>
      <td>87%</td>
    </tr>
    <tr>
      <td>Enrolled children present in school on deworming day</td>
      ```{r enrolled-children, results='asis'}
      query_enrolled_children <- "SELECT round, value FROM dd_main
                                  WHERE year = 2023
                                  AND state = 'Rivers'
                                  AND variable = 'Proportion of students who were present on DD'
                                  AND Round IN ('Round 1', 'Round 2', 'Overall')"
      enrolled_children_data <- dbGetQuery(con, query_enrolled_children)
      
      rounds <- c('Round 1', 'Round 2', 'Overall')
      
      for (i in 1:length(rounds)) {
        round_name <- rounds[i]
        index <- which(enrolled_children_data$round == round_name)
        cat("<td>")
        if (length(index) > 0) {
          cat(scales::percent(enrolled_children_data$value[index]), " ")
        } else {
          cat("N/A ")
        }
        cat("</td>")
      }
      ```
    </tr>
    <tr>
      <tr class="coverage-validation">
      <td>Coverage Validation</td>
      <td>Year 6, Round 1</td>
      <td>Year 6, Round 2</td>
      <td>Overall</td>
    </tr>
    <tr>
      <td>Targeted children who report receiving unprogrammed deworming in the last six months</td>
      <td>21%</td>
      <td>N/A<sup>4</sup></td>
      <td>21%</td>
    </tr>
    <tr>
      <td>Target population validated as swallowing deworming tablets on deworming day based on Coverage Validation</td>
      <td>86%</td>
      <td>N/A</td>
      <td>86%</td>
    </tr>
  </table>
</div>


##### **Table 2: Coverage Validation Survey Results**

<!-- Table Styles -->
<style>
.custom-table {
  border-collapse: collapse;
  width: 100%;
}

.custom-table td,
.custom-table th {
  border: 1px solid #000;
  padding: 8px;
  text-align: center;
}

.custom-table th {
  background-color: #fe6e87;
}

.custom-table .bold-row th {
  font-weight: bold;
}

.custom-table .border-left th,
.custom-table .border-left td {
  border-left: 1px solid #000;
}

.custom-table .border-right th,
.custom-table .border-right td {
  border-right: 1px solid #000;
}
</style>

<!-- Your Table -->
<div class="custom-table">
  <table>
    <tr>
      <th colspan="1">LGA</th>
      <th colspan="3">Program Reach</th>
      <th colspan="3">Surveyed Coverage</th>
      <th colspan="1">Reported Coverage</th>
      <th colspan="1">Denominator</th>
    </tr>
    <tr class="bold-row">
      <td></td>
      <td>Mean (%)</td>
      <td>% Lower bound CI</td>
      <td>% Upper bound CI</td>
      <td>Mean (%)</td>
      <td>% Lower bound CI</td>
      <td>% Upper bound CI</td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <td>Emohua</td>
      <td>84%</td>
      <td>82%</td>
      <td>86%</td>
      <td>83%</td>
      <td>78%</td>
      <td>87%</td>
      <td>86%</td>
      <td>1,671</td>
    </tr>
    <tr>
      <td>Opobo / Nkoro</td>
      <td>92%</td>
      <td>90%</td>
      <td>94%</td>
      <td>91%</td>
      <td>88%</td>
      <td>94%</td>
      <td>86%</td>
      <td>701</td>
    </tr>
  </table>
</div>


Overall, Y6 implementation was successful, with several KPIs improving since the previous round. Improvements in school attendance resulted in a 20 percentage point increase from 56% in year 5. On deworming week, material distribution was also commendable, with all (100%) and 75% of schools having deworming medicine and monitoring forms,  respectively. Community awareness of deworming through IEC deworming materials or word of mouth was at 73% among parents. During deworming week, the number of schools distributing mebendazole tablets increased; 87% of expected schools distributed tablets, a 27 percentage point increase from the previous year. Further details on priorities for program improvement and ways forward can be found on page 28.

## <span style="color:#fe6e87;">2.0 Background</span>

In total, 1.88 million  SAC were targeted for deworming treatments across 21 endemic LGAs for soil-transmitted helminths (STH) and 1.64 million SAC were treated (87% government reported treatment coverage).

Approximately 9760 teachers were trained to properly administer deworming drugs.

Evidence Action recruited an independent firm, Infotrak Research, and Consulting, to monitor random samples of program activities to assess the quality of implementation, adherence to protocol, and supply chain effectiveness. During the year, monitors observed 14 LGA trainings, 47 teacher trainings, and 60 schools on deworming day, and interviewed 168 parents in the community. Evidence Action designed data collection tools and sampling methods, and cleaned and analyzed the data from the above activities. The findings are presented in this report.


## <span style="color:#fe6e87;">3.0 Methodology</span>

### <span style="color:#fe6e87;">3.1 Process Monitoring</span>

To assess the quality of teacher training and the implementation of deworming, Evidence Action randomly selected 48 of approximately 339 total teacher training sessions for observation and training assessment, and 60 of about 5,410 total schools for observation and interviews of teachers, children, and parents by independent monitors on deworming day. Seventy percent (73% in round one and 67% in round two) of schools observed were primary level, 17% (17% in each round) were junior secondary level, 10% (10% in each round) included both levels, and 3% (0% in round one and 7% in round two)were nursery and primary level. By school type, 58% (63% in round one and 53% in round two) were public and 42% (37% in round one and 47% in round two) were private. 

Monitors observed sampled teacher training sessions and interviewed trainers. Before the start of these sessions, four participants were targeted for pre-training interviews and four participants for post-training interviews. The participants were systematically sampled so that every third participant to arrive at the venue was interviewed pre-training, and every third participant to receive training materials was selected for a post-interview.

On deworming day, monitors interviewed head teachers and teachers from sampled schools regarding their plans for deworming, their treatment knowledge, and any sensitization activities they had carried out in schools and local communities. Monitors then observed the drug administration process to verify that the required deworming procedures were followed. After treatment, monitors randomly selected and interviewed two enrolled children and one  non-enrolled child. Parents residing in areas around the selected schools were interviewed on deworming day to gauge their level of awareness of the program. At each of the 60 visited communities, monitors targeted 3 parents (a total of 180 parents) for such interviews -- 2 parents of children enrolled in school and 1 parent of children not enrolled in school (in total, 119 parents of enrolled children and 49 parents of non-enrolled children were found for interview). A timeline for the cascade of activities is shown in - Figure 1 below.

##### **Figure 1: Timeline of events cascade**

![](https://i.postimg.cc/W16JhSdk/figure-1.jpg)

### <span style="color:#fe6e87;">3.2 Coverage Validation</span>

A few weeks after the round one MDA, monitors conducted coverage validation to determine the program reach and surveyed coverage, per WHO guidelines while surveying schools and communities. A total of 2,372 children were interviewed from the two LGAs using a two-stage probability proportional to estimated size (PPES) sampling design.

##### **Table 3: Process monitoring and coverage validation targeted and actual sample sizes**

<!-- Table Styles -->
<style>
.custom-table {
  border-collapse: collapse;
}

.custom-table td,
.custom-table th {
  border: 1px solid #000;
  padding: 8px;
  text-align: center;
}

.custom-table th {
  background-color: #fe6e87;
}

.gray-row th {
  background-color: #C0C0C0;
  border: none;
}

.green-row th {
  background-color: #C0C0C0;
  border: none;
}

.green-row td {
  border-left: none;
  border-right: none;
}

.green-row td:first-child {
  border-left: 1px solid #000;
}
</style>

<!-- Your Table -->
<div class="custom-table">
  | Monitoring activity                           | Target sample size | Actual sample size |
  |-----------------------------------------------|--------------------|--------------------|
  | LGA and teacher training                      |                    |                    |
  | LGA training sessions                         | 14                 | 14                 |
  | Pre-training LGA interviews                   | 56                 | 51                 |
  | Post-training LGA interviews                  | 56                 | 56                 |
  | Teacher training sessions                     | 48                 | 47                 |
  | Pre-training teacher interviews               | 192                | 184                |
  | Post-training teacher interviews              | 192                | 182                |
  | Post-training LGA FLHF staff interviews       | 42                 | 25<sup>8</sup>                 |
  | Deworming day interviews                      |                    |                    |
  | Schools targeted for monitoring on deworming day | 60               | 60                 |
  | Parents of non-enrolled children interviewed on deworming day | 60 | 49<sup>9</sup>         |
  | Parents of enrolled children interviewed on deworming day | 120         | 119        |
  | Enrolled children interviewed                 | 120                | 118                |
  | Head teachers interviewed                     | 60                 | 60                 |
  | Teachers interviewed                          | 60                 | 60                 |
  | FLHF staff interviewed                        | 60                 | 28<sup>10</sup>   |
  | Coverage validation                           |                    |                    |
  | Number of children interviewed                | 2,357              | 2,372<sup>11</sup>|
</div>

## <span style="color:#fe6e87;">4.0 Process Monitoring Results</span>

### <span style="color:#fe6e87;">4.1 Training Results</span>

```{r training-results, echo=FALSE}

sql_query_lga <- "SELECT attibutes, variable, Round
FROM lga_obs
WHERE Round = 'Overall'
AND year = 2022
AND state = 'Rivers'
AND variable = 'Sample size'"

sql_query_tt <- "SELECT attibutes, variable, Round
FROM tt_obs
WHERE Round = 'Overall'
AND year = 2022
AND state = 'Rivers'
AND variable = 'Sample size'"

data_lga <- dbGetQuery(con, sql_query_lga)
data_tt <- dbGetQuery(con, sql_query_tt)

# Calculate the percentage and display the text

value_percent_lga <- data_lga$attibutes[data_lga$variable == 'Sample size']
value_percent_tt <- data_tt$attibutes[data_tt$variable == 'Sample size']

renderText(sprintf(
  "Monitors observed a sample of %s LGA level trainings and %s teacher trainings (TT) to measure the delivery and effectiveness of training sessions. Before the start of the training sessions, the monitors held interviews with the trainers to gauge their preparedness and deworming knowledge. To share information and keep participants engaged, trainers are encouraged to use a combination of teaching methods, as described in - Figure 2.",
  value_percent_lga,
  value_percent_tt
))
```


##### **Figure 2: Training attendance, methods, and venue**

```{r plot, echo=FALSE}

library(ggplot2)
library(gridExtra)

# SQL query with a WHERE clause for the state of Rivers (LGA data)
sql_query_lga <- "SELECT variable, value
 FROM lga_obs 
 WHERE state = 'Rivers'
 AND round = 'Overall'
 AND year = 2022
 AND (variable = 'Attendance rate at the start' OR variable = 'Day 1 overall attendance rate' OR  variable = 'Day 2 overall attendance rate')"

data_lga <- dbGetQuery(con, sql_query_lga)

# Mapping original variable names to desired names(lga)
variable_mapping_lga <- c('Day 1 overall attendance rate' = 'Day 1 overall attendance rate(n=14)',
                       'Day 2 overall attendance rate' = 'Day 2 overall attendance rate(n=8)',
                       'Attendance rate at the start' = 'Day 1 timely attendance(n=14)')

# Apply the mapping to the 'variable' column in data_lga
data_lga$variable_mapped <- variable_mapping_lga[data_lga$variable]

# SQL query with a WHERE clause for the state of Rivers (TT data)
sql_query_tt <- "SELECT variable, value
 FROM tt_obs 
 WHERE year = 2022
 AND round = 'Overall'
 AND variable IN ('timely_attendance', 'School attendance Rate', 'Teachers attendance rate')"

data_tt <- dbGetQuery(con, sql_query_tt)

# Mapping original variable names to desired names(tt)
variable_mapping_tt <- c('timely_attendance' = 'Timely attendance of teachers(n=47)',
                       'School attendance Rate' = 'Overall school attendance(n=47)',
                       'Teachers attendance rate' = 'Overall teacher attendance rate(n=47)')

# Apply the mapping to the 'variable' column in data_tt
data_tt$variable_mapped <- variable_mapping_tt[data_tt$variable]

# SQL query with a WHERE clause for the state of Rivers (TT2 data)
sql_query_tt2 <- "SELECT *
FROM tt_obs
WHERE year = 2022
AND round = 'Overall'
AND variable = 'Overall Training methods employed'
AND attibutes != 'Group work'"

data_tt2 <- dbGetQuery(con, sql_query_tt2)

# Plotting for LGA Training Attendance data
plot_lga <- ggplot(data_lga, aes(x = variable_mapped, y = value, fill = variable_mapped)) +
    geom_bar(stat = "identity", position = "identity", color = "white", fill = "#fe6e87") +
    geom_text(aes(label = scales::percent(value)), hjust = -0.2, size = 3) +
    labs(title = "LGA training attendance:", x = NULL, y = NULL) +
    coord_flip() +
    theme_minimal() +
    theme(axis.text.x = element_blank())  # Remove x-axis text

# Plotting for TT Training Attendance data
plot_tt <- ggplot(data_tt, aes(x = variable_mapped, y = value, fill = variable_mapped)) +
    geom_bar(stat = "identity", position = "identity", color = "white", fill = "#fe6e87") +
    geom_text(aes(label = scales::percent(value)), hjust = -0.2, size = 3) +
    labs(title = "Teacher training attendance:", x = NULL, y = NULL) +
    coord_flip() +
    theme_minimal() +
    theme(axis.text.x = element_blank())  # Remove x-axis text

# Plotting for Teacher training methods data
plot_tt2 <- ggplot(data_tt2, aes(x = attibutes, y = value, fill = variable)) +
    geom_bar(stat = "identity", position = "identity", color = "white", fill = "#fe6e87") +
    geom_text(aes(label = scales::percent(value)), hjust = -0.2, size = 3) +
    labs(title = "Teacher training methods (n=47):", x = NULL, y = NULL) +
    coord_flip() +
    theme_minimal() +
    theme(axis.text.x = element_blank())  # Remove x-axis text

# Arrange plots vertically
grid.arrange(plot_lga, plot_tt, plot_tt2, ncol = 1)

```


On average, 64% of expected schools had a representative in attendance at the monitored teacher training sessions, with 58% of teachers on-time - **Figure 2.**  During TT post-training interviews, 91% of attendees reported attending the entire training. An attendance register was noted across 93% of LGA trainings and all (100%) TTs were monitored - **Figure 3.**


##### **Figure 3: Composition of trainers, trainees, and register availability in TTs**

```{r figure3, echo=FALSE}

library(ggplot2)
library(gridExtra)
library(stringr)

# SQL query
sql_query1 <- "SELECT * FROM tt_admin
              WHERE year = 2022
              AND round = 'Overall'
              AND variable = 'Which ministries , boards, and/or agencies- are all the trainers for this training session from?'"

data <- dbGetQuery(con, sql_query1)

# Mapping original variable names to desired names
variable_mapping <- c('Ministry Of Health(MoH)' = 'Ministry of Health (n=47)',
                       'Ministry Of Education(MoE).' = 'Ministry of Education (n=47)')

# Creating a new variable with the desired names
data$variable_mapped <- variable_mapping[data$attibutes]

# SQL query
sql_query2 <- "SELECT 
    tt.variable,
    tt.attibutes,
    CASE 
        WHEN tt.attibutes IN ('Other:Facilitator', 'Other:N-power') 
            THEN ot.total_sum
        ELSE tt.value 
    END AS total_value
FROM ttci_prepost tt
LEFT JOIN (
    SELECT 
        variable,
        SUM(value) AS total_sum
    FROM ttci_prepost
    WHERE 
        year = 2022
        AND round = 'Overall'
        AND sourcefile = 'POST'
        AND variable = 'ASK THE RESPONDENT: What is your position?'
        AND attibutes IN ('Other:Facilitator', 'Other:N-power')
    GROUP BY variable
) ot ON tt.variable = ot.variable
WHERE 
    tt.year = 2022
    AND tt.round = 'Overall'
    AND tt.sourcefile = 'POST'
    AND tt.variable = 'ASK THE RESPONDENT: What is your position?'"

data2 <- dbGetQuery(con, sql_query2)

# Mapping original variable names to desired names
variable_mapping <- c('Head Teacher Representative' = 'Head teacher representatives',
                       'Head Teacher' = 'Head teachers',
                      'Health Teacher' = 'Health teachers',
                      'Health Teacher Representative' = 'Health teacher representatives',
                      'Other:Facilitator' = 'Others')

# Creating a new variable with the desired names
data2$variable_mapped <- variable_mapping[data2$attibutes]

# SQL query
sql_query3 <- "SELECT * FROM tt_admin
               WHERE year = 2022
               AND round = 'Overall'
               AND variable = 'Can you show me the materials and deworming medicine to be distributed to teachers today?'
               AND attibutes = 'Class treatment register'"

data3 <- dbGetQuery(con, sql_query3)

# Mapping original variable names to desired names
variable_mapping <- c('Class treatment register' = 'Availability of attendance register during teacher training')

# Creating a new variable with the desired names
data3$variable_mapped <- variable_mapping[data3$attibutes]

# Plotting for trainer data
plot <- ggplot(data, aes(x = variable_mapped, y = value, fill = variable_mapped)) +
    geom_bar(stat = "identity", position = "identity", color = "white", fill = "#fe6e87") +
    geom_text(aes(label = scales::percent(value), y = value, group = variable_mapped), 
              position = position_stack(vjust = 0.5), size = 3) +
    labs(title = "Trainer composition:", x = NULL, y = NULL) +
    coord_flip() +
    theme_minimal() +
    theme(axis.text.x = element_blank()) +  # Remove x-axis text
    scale_x_discrete(labels = function(x) str_wrap(x, width = 20))

# Plotting for trainee data
plot2 <- ggplot(data2, aes(x = variable_mapped, y = total_value, fill = variable_mapped)) +
    geom_bar(stat = "identity", position = "identity", color = "white", fill = "#fe6e87") +
    geom_text(aes(label = scales::percent(total_value), y = total_value, group = variable_mapped), 
              position = position_stack(vjust = 0.5), size = 3) +
    labs(title = "Trainee composition (n=182):", x = NULL, y = NULL) +
    coord_flip() +
    theme_minimal() +
    theme(axis.text.x = element_blank()) +  # Remove x-axis text
    scale_x_discrete(labels = function(x) str_wrap(x, width = 20))

# Plotting for attendance_register data
plot3 <- ggplot(data3, aes(x = variable_mapped, y = value, fill = variable_mapped)) +
    geom_bar(stat = "identity", position = "identity", color = "white", fill = "#fe6e87") +
    geom_text(aes(label = scales::percent(value), y = value, group = variable_mapped), 
              position = position_stack(vjust = 0.5), size = 3) +
    labs(title = NULL, x = NULL, y = NULL) +
    coord_flip() +
    theme_minimal() +
    theme(axis.text.x = element_blank()) + # Remove x-axis text
    scale_x_discrete(labels = function(x) str_wrap(x, width = 20))

# Arrange plots vertically and align them on the left
grid.arrange(plot, plot2, plot3, ncol = 1)
```


#### <span style="color:#fe6e87;">Topic coverage</span>

Seven topics were meant to be covered across the training sessions. The topic of community sensitization was covered in 94% of the training sessions, while at least 98% of the training sessions covered the other six topics. The topics of recording and reporting forms, health education, target population, and deworming medicine administration were covered in all (100%) training - **Figure 4.** 


##### **Figure 4: Topic coverage (n=47)**


```{r figure4, echo=FALSE}

library(ggplot2)

# SQL query to sum the values for 'Covered Completely' and 'Covered Partially'
sql_query_sum <- "
SELECT variable, 
       SUM(CASE WHEN attibutes = 'Covered Completely' THEN value ELSE 0 END) as covered_completely,
       SUM(CASE WHEN attibutes = 'Covered Partially' THEN value ELSE 0 END) as covered_partially
FROM tt_obs
WHERE year = 2022
AND state = 'Rivers'
AND round = 'Overall'
AND variable IN ('Overall coverage of recording and reporting forms', 'STH coverage of information on health education- worms', 'Coverage of STH drug distribution', 'Overall coverage of roles and responsibilities', 'Coverage of information on side effects', 'Overall coverage of information on community sensitization')
GROUP BY variable;
"

data_sum <- dbGetQuery(con, sql_query_sum)

# Mapping original variable names to desired names
variable_mapping <- c('Overall coverage of recording and reporting forms' = 'Recording and reporting forms',
                       'STH coverage of information on health education- worms' = 'Health education',
                       'Coverage of STH drug distribution' = 'Deworming medicine administration',
                       'Coverage of information on side effects' = 'Side effects',
                       'Overall coverage of information on community sensitization' = 'Community sensitization')

# Creating a new variable with the desired names
data_sum$variable_mapped <- variable_mapping[data_sum$variable]

# Calculate the total for each variable
data_sum$total <- rowSums(data_sum[, c("covered_completely", "covered_partially")])

# Plotting the horizontal stacked bar chart with percentages
ggplot(data_sum, aes(x = covered_completely + covered_partially, y = variable_mapped, fill = variable_mapped)) +
  geom_bar(stat = "identity", position = "stack", color = "white", width = 0.7) +
  geom_text(aes(label = sprintf("%.0f%%", total * 100)),
            position = position_stack(vjust = 0.5),
            color = "black", size = 2.5) +  # Adjusted font size
  labs(title = NULL,
       x = NULL,
       y = NULL) +
  scale_fill_manual(values = c("#FE6E87", "#FE6E87", "#FE6E87", "#FE6E87", "#FE6E87")) +
  theme_minimal() +
  theme(axis.text.y = element_text(hjust = 0),
        axis.text.x = element_blank(),  # Remove x-axis text
        plot.title = element_text(size = 14),
        legend.position = "none")  # Remove the legend
```


 
#### <span style="color:#fe6e87;">Topic 1: Health Education</span>

##### **Figure 5: Health education messages covered in trainings and participants’ pre- and post-training knowledge**

```{r figure 5, echo=FALSE, fig.height=6, fig.width = 8}

library(ggplot2)
library(gridExtra)
library(stringr)

# SQL query to sum the values for 'Covered Completely' and 'Covered Partially'
sql_query_sum <- "SELECT variable,
       SUM(CASE WHEN attibutes = 'Covered Completely' THEN value ELSE 0 END) as covered_completely,
       SUM(CASE WHEN attibutes = 'Covered Partially' THEN value ELSE 0 END) as covered_partially
	FROM tt_obs   
WHERE year = 2022
AND round = 'Overall'
AND state = 'Rivers'
AND variable IN ('Worms are transmitted by :', 'How was this section (STH PREVENTION) covered?', 'How was this section (STH MORBIDITY) covered?',
				 'BENEFITS OF DEWORMING IN SCHOOLS')
GROUP BY variable"

data_sum <- dbGetQuery(con, sql_query_sum)

# Mapping original variable names to desired names
variable_mapping <- c('Worms are transmitted by :' = 'Transimission of worms',
                       'BENEFITS OF DEWORMING IN SCHOOLS' = 'Purpose of school-based deworming',
                       'How was this section (STH PREVENTION) covered?' = 'Prevention of worms',
                       'How was this section (STH MORBIDITY) covered?' = 'Negative effect of worms')

# Creating a new variable with the desired names
data_sum$variable_mapped <- variable_mapping[data_sum$variable]

# Calculate the total for each variable
data_sum$total <- rowSums(data_sum[, c("covered_completely", "covered_partially")])

# SQL query pre&post
sql_query <- "SELECT * FROM ttci_prepost
WHERE year = 2022
AND round = 'Overall'
AND state = 'Rivers'
AND variable = 'How do children get infected with worms?'
AND attibutes IN ('Walking Bare Feet', 'Swimming In Dirty Water', 'Lack Of Proper Hand Washing', 'Absence Of Latrine/Open Defeacation', 'Eating Unwashed Fruits And Vegetables', 'Eating Unwell Cooked/Infected Meat')"

data <- dbGetQuery(con, sql_query)

# Plotting for healthEducation topics data
plot <- ggplot(data_sum, aes(x = variable_mapped, y = total, fill = variable_mapped)) +
    geom_bar(stat = "identity", position = "identity", color = "white", fill = "#fe6e87") +
    geom_text(aes(label = scales::percent(total), y = total, group = variable_mapped), 
              position = position_stack(vjust = 0.5), size = 3) +

    labs(title = "Health education topics\ncompletely covered in trainings (n=47)", x = NULL, y = NULL) +

    coord_flip() +
    theme_minimal() +
    theme(axis.text.x = element_blank()) +  # Remove x-axis text
    scale_x_discrete(labels = function(x) str_wrap(x, width = 20))

# Plotting for tt_pre and tt_post knowledge on transmission
plot2 <- ggplot(data, aes(x = sourcefile, y = value, fill = sourcefile)) +
     geom_bar(stat = "identity", position = "dodge", color = "white") +
     facet_wrap(~attibutes, scales = 'free_y', ncol = 1) +
     labs(title = "Pre- and post-\nknowledge on transimission", x = NULL, y = NULL) +
     coord_flip() +
     theme_minimal() +
     theme(axis.text.x = element_blank()) +  # Remove x-axis text
     geom_text(aes(label = scales::percent(value), group = attibutes),
               position = position_dodge(width = 0.8),  
               vjust = -0.5, size = 3) +  
     scale_fill_manual(values = c("#fe6e87", "#D3D3D3"), name = NULL)+
  guides(fill = guide_legend(override.aes = list(title = NULL))) +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 20))

# Print the plot
 grid.arrange(plot, plot2, ncol = 2)
```


The coverage of the four health education messages and participants’ post-training recollection, is shown in - **Figure 5** above. Post-training interviews with participants revealed that 99% could name at least one way a person becomes infected with worms. Additionally, 70% of teachers shared health messages with children before deworming.

#### <span style="color:#fe6e87;">Topic 2: Target Population</span>

Proper identification of the target group is critical to meeting the program goal of treating all eligible at-risk persons. **Figure 6** below shows training coverage of the target population and knowledge during deworming day. It also displays training coverage of non-eligible persons, as well as pre- and post-training knowledge scores.

##### **Figure 6: Information on target population and pre-post knowledge of treatment eligibility criteria**

```{r figure6, echo=FALSE}

library(ggplot2)
library(gridExtra)
library(stringr)

# SQL query LGA training
sql_query <- "SELECT * FROM lga_obs 
WHERE year = 2022
AND state = 'Rivers'
AND round = 'Overall'
AND variable = 'STH treatment will be provided to all children aged 5-14 years'"

data <- dbGetQuery(con, sql_query)

# Mapping original variable names to desired names
variable_mapping <- c('STH treatment will be provided to all children aged 5-14 years' = 'All children aged 5-14 years will be treated for STH')

# Creating a new variable with the desired names
data$variable_mapped <- variable_mapping[data$variable]

# SQL query to sum the values for 'Covered Completely' and 'Covered Partially' Teacher training
sql_query2 <- "SELECT year, state, round, variable,
  'Teacher Training' AS attibutes,
  SUM(CASE WHEN attibutes = 'Covered Completely' THEN value ELSE 0 END) +
  SUM(CASE WHEN attibutes = 'Covered Partially' THEN value ELSE 0 END) AS total_sum
FROM tt_obs
WHERE
  year = 2022
  AND state = 'Rivers'
  AND round = 'Overall'
  AND variable = 'STH treatment will be provided to all children aged 5-14 years:'
  AND attibutes IN ('Covered Completely', 'Covered Partially')
GROUP BY year, state, round, variable"

data2 <- dbGetQuery(con, sql_query2)

# Mapping original variable names to desired names
variable_mapping <- c('STH treatment will be provided to all children aged 5-14 years:' = 'All children aged 5-14 years will be treated for STH')

# Creating a new variable with the desired names
data2$variable_mapped <- variable_mapping[data2$variable]

# SQL query deworming team
sql_query3 <- "SELECT * FROM dd_main
WHERE year = 2022
AND state = 'Rivers'
AND round = 'Overall'
AND variable = '% of deworming team with full knowledge of STH treatment'"

data3 <- dbGetQuery(con, sql_query3)

# Mapping original variable names to desired names
variable_mapping <- c('% of deworming team with full knowledge of STH treatment' = 'School deworming team knowledge of correct age-group (n=60)')

# Creating a new variable with the desired names
data3$variable_mapped <- variable_mapping[data3$variable]

# Plotting for LGA training data
plot <- ggplot(data, aes(x = variable_mapped, y = value, fill = variable_mapped)) +
    geom_bar(stat = "identity", position = "identity", color = "white", fill = "#fe6e87") +
    geom_text(aes(label = scales::percent(value), y = value, group = variable_mapped), 
              position = position_stack(vjust = 0.5), size = 3) +
    labs(title = "LGA training (n=14)", x = NULL, y = NULL) +
    coord_flip() +
    theme_minimal() +
    theme(axis.text.x = element_blank()) +  # Remove x-axis text
    scale_x_discrete(labels = function(x) str_wrap(x, width = 20))

# Plotting for Teacher training data
plot2 <- ggplot(data2, aes(x = variable_mapped, y = total_sum, fill = variable_mapped)) +
    geom_bar(stat = "identity", position = "identity", color = "white", fill = "#fe6e87") +
    geom_text(aes(label = scales::percent(total_sum), y = total_sum, group = variable_mapped), 
              position = position_stack(vjust = 0.5), size = 3) +
    labs(title = "Teacher training (n=47)", x = NULL, y = NULL) +
    coord_flip() +
    theme_minimal() +
    theme(axis.text.x = element_blank()) + # Remove x-axis text
    scale_x_discrete(labels = function(x) str_wrap(x, width = 20))

# Plotting for deworming team data
plot3 <- ggplot(data3, aes(x = variable_mapped, y = value, fill = variable_mapped)) +
    geom_bar(stat = "identity", position = "identity", color = "white", fill = "#fe6e87") +
    geom_text(aes(label = scales::percent(value), y = value, group = variable_mapped), 
              position = position_stack(vjust = 0.5), size = 3) +
    labs(title = "Deworming day knowledge of the target age-group", x = NULL, y = NULL) +
    coord_flip() +
    theme_minimal() +
    theme(axis.text.x = element_blank()) +  # Remove x-axis text
    scale_x_discrete(labels = function(x) str_wrap(x, width = 20))

# plotting
grid.arrange(plot, plot2, plot3, ncol=1)
```





```{r figure6(ii), echo=FALSE, fig.width=8, fig.height=6 }

library(ggplot2)
library(gridExtra)
library(stringr)

# SQL query Non-eligible person covered
sql_query <- "SELECT * FROM tt_obs
WHERE year = 2022
AND state = 'Rivers'
AND round = 'Overall'
AND variable = 'According to the trainers, which children should not be treated under the program?'
AND attibutes IN ('Any child sick on DD', 'Any child with an inherent health condition such as Sickle Cell disease, Epileps','Any child under 5 years')"

data <- dbGetQuery(con, sql_query)

# Mapping original variable names to desired names
variable_mapping <- c('Any child sick on DD' = 'Sick children',
                      'Any child under 5 years' = 'Children under 5 years',
                      'Any child with an inherent health condition such as Sickle Cell disease, Epileps' = 'Children with history of sicle cell disease, epilepsy etc.')

# Creating a new variable with the desired names
data$variable_mapped <- variable_mapping[data$attibutes]

# Use reorder to arrange bars from smallest to highest
data$variable_mapped <- reorder(data$variable_mapped, data$value)

# SQL query Non-eligible person covered
sql_query2 <- "SELECT * FROM ttci_prepost
WHERE year = 2022
AND state = 'Rivers'
AND round = 'Overall'
AND variable = 'Which category of children should not be given deworming medicine on the deworming day?'
AND attibutes IN ('Sick children', 'Children under any medication', 'Children with known allergy to deworming medicine', 'Children with history of seizures')"

data2 <- dbGetQuery(con, sql_query2)

# Plotting for Non-eligible persons data
plot <- ggplot(data, aes(x = variable_mapped, y = value, fill = variable_mapped)) +
    geom_bar(stat = "identity", position = "identity", color = "white", fill = "#fe6e87") +
    geom_text(aes(label = scales::percent(value), y = value, group = variable_mapped), 
              position = position_stack(vjust = 0.5), size = 3) +
    labs(title = "Non-eligible persons covered\nin trainings (n=47)", x = NULL, y = NULL) +
    coord_flip() +
    theme_minimal() +
    theme(axis.text.x = element_blank()) + # Remove x-axis text
  scale_x_discrete(labels = function(x) str_wrap(x, width = 20))

# Plotting for Knowledge on non-eligible person data
plot2 <- ggplot(data2, aes(x = sourcefile, y = value, fill = sourcefile)) +
     geom_bar(stat = "identity", position = "dodge", color = "white") +
     facet_wrap(~attibutes, scales = 'free_y', ncol = 1) +
     labs(title = "Knowledge on non-eligible persons", x = NULL, y = NULL) +
     coord_flip() +
     theme_minimal() +
     theme(axis.text.x = element_blank()) +  # Remove x-axis text
     geom_text(aes(label = scales::percent(value), group = attibutes),
               position = position_dodge(width = 0.8),  
               vjust = 0.5, size = 3) +  
     scale_fill_manual(values = c("#fe6e87", "#D3D3D3"), name = NULL)+
  guides(fill = guide_legend(override.aes = list(title = NULL)))+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 20))


# Adjust the overall layout to add spacing between the plots
grid.arrange(plot, plot2, ncol = 2)
```

#### <span style="color:#fe6e87;">Topic 3: Roles and Responsibilities</span>

The success of the MDA hinges on the proper identification of the contributions of various actors and the roles they play throughout the MDA. The sessions on the roles and responsibilities of teachers were covered in 98% of the monitored teacher training sessions. LGA training sessions emphasized the role of head teachers in discussing deworming day at school management meetings, PTA meetings, etc. (100%) - **Figure 7.**

##### **Figure 7: Roles and responsibilities covered by trainers in LGA and teacher trainings**

```{r figure 7, echo=FALSE}

library(ggplot2)
library(gridExtra)
library(stringr)

# sql query responsibilities of teachers tt
sql_query <- "SELECT * FROM tt_obs
WHERE year = 2022
AND state = 'Rivers'
AND round = 'Overall'
AND variable = 'According to the trainers, what is the role of the teachers/CIs in the deworming program?'
AND attibutes IN ('To organize drug administration in schools', 'To disseminate health education messages for children and parents during assembl','To mobilize non-enrolled school-aged children','To complete forms for registration and reporting')"

data <- dbGetQuery(con, sql_query)

# Mapping original variable names to desired names
variable_mapping <- c('To organize drug administration in schools' = 'To organize administration of deworming medicine in schools',
                       'To disseminate health education messages for children and parents during assembl' = 'To disseminate health education messages for children and parents during assembly and PTA meeting',
                      'To mobilize non-enrolled school-aged children' = 'To mobilize non-enrolled school-aged children',
                      'To complete forms for registration and reporting' = 'To complete forms for registration and reporting')

# Creating a new variable with the desired names
data$variable_mapped <- variable_mapping[data$attibutes]

# Use reorder to arrange bars based on value
data$variable_mapped <- reorder(data$variable_mapped, data$value)

# Plotting for Non-eligible persons data
plot <- ggplot(data, aes(x = variable_mapped, y = value, fill = variable_mapped)) +
     geom_bar(stat = "identity", position = "identity", color = "white", fill = "#fe6e87") +
     geom_text(aes(label = scales::percent(value), y = value, group = variable_mapped), 
               position = position_stack(vjust = 0.5), size = 3) +
     labs(title = "Responsibilities of teachers covered during teacher training (n=47)", x = NULL, y = NULL) +
     coord_flip() +
     theme_minimal() +
     theme(axis.text.x = element_blank()) +  
    scale_x_discrete(labels = function(x) str_wrap(x, width = 20))

print(plot)
```



```{r figure7(ii), echo = FALSE}

library(ggplot2)
library(gridExtra)
library(stringr)

# sql query responsibilities of flhf staff
sql_query <- "SELECT * FROM tt_obs
WHERE year = 2022
AND state = 'Rivers'
AND round = 'Overall'
AND variable = 'According to the trainers, what is the role of the frontline health facility staff in the deworming program?'
AND attibutes IN  ('To communicate the rationale of the intervention to community leaders',
'To participate in community awareness creation for drug administration campaign', 'To manage side-effects', 'To manage, refer, and report children with severe adverse effects', 'To help with treating non-enrolled children')"

data <- dbGetQuery(con, sql_query)

# Use reorder to arrange bars based on value
data$attibutes <- reorder(data$attibutes, data$value)

# Plotting for responsibilities of flhf staff data
plot <- ggplot(data, aes(x = attibutes, y = value, fill = attibutes)) +
     geom_bar(stat = "identity", position = "identity", color = "white", fill = "#fe6e87") +
     geom_text(aes(label = scales::percent(value), y = value, group = attibutes), 
               position = position_stack(vjust = 0.5), size = 3) +
     labs(title = "Responsibilities of FLHF staff covered during teacher training (n=47)", x = NULL, y = NULL) +
     coord_flip() +
     theme_minimal() +
     theme(axis.text.x = element_blank()) +  
    scale_x_discrete(labels = function(x) str_wrap(x, width = 20))

print(plot)

```


**Figure 8**, below, shows frontline health facility (FLHF) staff knowledge of their roles and responsibilities on deworming day.

##### **Figure 8: Self-reported roles during deworming day**


```{r figure8, echo=FALSE}

library(ggplot2)
library(gridExtra)
library(stringr)

# sql query to get data (self-reported roles during deworming day)
sql_query <- "SELECT * FROM dd_main
WHERE year = 2022
AND state = 'Rivers'
AND round = 'Overall'
AND variable = 'ASK: What are your responsibilities as a FLHF in the School-based Deworming Program?'
AND attributes IN ('Community Sensitization', 'Support Teachers on SAE', 'Orient FLHF Staff on the SBDP', 'Other:Supervisor')"

data <- dbGetQuery(con, sql_query)

# Mapping original variable names to desired names
variable_mapping <- c('Support Teachers on SAE' = 'Support teachers on severe adverse events (SAE)',
                      'Community Sensitization' = 'Community Sensitization',
                      'Orient FLHF Staff on the SBDP' = 'Orient FLHF Staff on the school-based deworming program (SBDP)',
                      'Other:Supervisor' = 'Supervision of schools')

# Creating a new variable with the desired names
data$variable_mapped <- variable_mapping[data$attributes]

# Use reorder to arrange bars based on value
data$variable_mapped <- reorder(data$variable_mapped, data$value)

# Plotting
plot <- ggplot(data, aes(x = variable_mapped, y = value, fill = variable_mapped)) +
     geom_bar(stat = "identity", position = "identity", color = "white", fill = "#fe6e87") +
     geom_text(aes(label = scales::percent(value), y = value, group = variable_mapped), 
               position = position_stack(vjust = 0.5), size = 3) +
     labs(title = "FLHF knowledge of roles during deworming day (n=28)", x = NULL, y = NULL) +
     coord_flip() +
     theme_minimal() +
     theme(axis.text.x = element_blank()) +  
    scale_x_discrete(labels = function(x) str_wrap(x, width = 20))

print(plot)
```

/* figure */


#### <span style="color:#fe6e87;">Topic 4: Community Sensitization</span>

Raising awareness of the MDA within the target geographic area and population is pivotal to the achievement of the target therapeutic coverage of at least 75% of the at-risk population. Ninety-three percent (93%) of LGA training and all (100%) teacher training sessions announced the date of deworming day/week during the training sessions, and all (100%) TT participants reported the correct date of deworming after training. Monitors noted that 94% of trainers covered how teachers and FLHF staff will conduct sensitization activities before the MDA during the sensitization and mobilization session of teacher training. Although 91% of trainers covered the responsibilities of teachers in community sensitization at the teacher training, fewer than 80% of the teachers could cite any of their specific responsibilities post-training - **Figure 9.**

##### **Figure 9: Community sensitization topics covered by trainers and post-training knowledge**

```{r figure9, echo=FALSE}

library(ggplot2)
library(gridExtra)
library(stringr)

# sql query to get data (messages covered under community sensitization)
sql_query <- "SELECT * FROM tt_obs
WHERE year = 2022
AND round = 'Overall'
AND state = 'Rivers'
AND variable = 'According to the trainers, what is the responsibility of the teacher/CI in community sensitization and mobilization?'
AND attibutes IN ('Conduct Health Education on assembly ground', 'Display Posters in the School', 'Discuss DD at School Management Meetings','Encourage Children to share DD Information with Parents')"

data <- dbGetQuery(con, sql_query)

# Use reorder to arrange bars from smallest to highest
data$attibutes <- reorder(data$attibutes, data$value)

# sql query to get data (Post-knowledge on sensitization roles)
sql_query2 <- "SELECT * FROM ttci_prepost
WHERE year = 2022
AND round = 'Overall'
AND state = 'Rivers'
AND variable = 'What are some of your responsibilities relating to community sensitization?'
AND attibutes IN ('Display Posters', 'Conduct health education in classrooms', 'Reach out to non-enrolled children and invite for deworming Day in my school', 'Share Deworming message during School Management Meetings',                       
'Announce deworming message in school assembly',
'Training and sensitizing other teachers',
'Encourage Children to share Deworming Day Information with Parents')"

data2 <- dbGetQuery(con, sql_query2)

# Use reorder to arrange bars from smallest to highest
data2$attibutes <- reorder(data2$attibutes, data2$value)

# Plotting 1
plot <- ggplot(data, aes(x = attibutes, y = value, fill = attibutes)) +
     geom_bar(stat = "identity", position = "identity", color = "white", fill = "#fe6e87") +
     geom_text(aes(label = scales::percent(value), y = value, group = attibutes), 
               position = position_stack(vjust = 0.5), size = 3) +
     labs(title = "Messages covered under\ncommunity sensitization during\nteacher training (n=47)", x = NULL, y = NULL) +
     coord_flip() +
     theme_minimal() +
     theme(axis.text.x = element_blank()) +  
    scale_x_discrete(labels = function(x) str_wrap(x, width = 20))

# Plotting 2
plot2 <- ggplot(data2, aes(x = attibutes, y = value, fill = attibutes)) +
     geom_bar(stat = "identity", position = "identity", color = "white", fill = "#fe6e87") +
     geom_text(aes(label = scales::percent(value), y = value, group = attibutes), 
               position = position_stack(vjust = 0.5), size = 3) +
     labs(title = "Post-knowledge on\nsensitization roles", x = NULL, y = NULL) +
     coord_flip() +
     theme_minimal() +
     theme(axis.text.x = element_blank()) +  
    scale_x_discrete(labels = function(x) str_wrap(x, width = 20))

grid.arrange(plot, plot2, ncol = 2)
```


/* figure2 */

#### <span style="color:#fe6e87;">Topic 5: Recording and Reporting Forms</span>

During MDAs, teachers are required to fill out treatment registers at the class level while head teachers fill out the school summary forms at the school level. Hence, they should be trained comprehensively on how to fill them in. Trainers are also required to inform teachers that all forms post-MDA are to be returned to the FLHF. A high proportion of trainers (100%) highlighted the need to record treatment on both forms - treatment registers and school summary forms, and a high proportion of participants recalled this information post-training (at least 86%) and on deworming day (at least 80%) - **Figure 10.**

##### **Figure 10: Messages shared about reporting forms and participants’ post-training knowledge**

```{r figure10, echo=FALSE}

library(ggplot2)
library(gridExtra)
library(stringr)

sql_query <- "SELECT * FROM dd_main
WHERE year = 2022
AND state = 'Rivers'
AND round = 'Overall'
AND variable IN ('ASK: What form will you or the designated teacher use to summarize school treatment?', 'Which recording and reporting forms are you responsible for?')
AND attributes IN ('School summary form', 'Treatment register')"

data <- dbGetQuery(con, sql_query)

# Mapping original variable names to desired names
variable_mapping <- c('School summary form' = 'School summary form by head teacher',
                      'Treatment register' = 'Treatment register by the deworming team')

# Creating a new variable with the desired names
data$variable_mapped <- variable_mapping[data$attributes]

# Use reorder to arrange bars based on value
data$variable_mapped <- reorder(data$variable_mapped, data$value)

# plotting
plot <- ggplot(data, aes(x = variable_mapped, y = value, fill = variable_mapped)) +
     geom_bar(stat = "identity", position = "identity", color = "white", fill = "#fe6e87") +
     geom_text(aes(label = scales::percent(value), y = value, group = variable_mapped), 
               position = position_stack(vjust = 0.5), size = 3) +
     labs(title ="Head teacher and class teacher\nknowledge of forms to be\nfilled on deworming day (n=60)", x = NULL, y = NULL) +
     coord_flip() +
     theme_minimal() +
     theme(axis.text.x = element_blank()) +  
    scale_x_discrete(labels = function(x) str_wrap(x, width = 20))

print(plot)

```


#### <span style="color:#fe6e87;">Topic 6: Drug Administration</span>

The drug administration topic was covered in all (100%) LGA and teacher training sessions, and all sub-topics were covered in at least 77% of the teacher trainings monitored - **Table 4.**

##### **Table 4: Messages on deworming medicine administration covered in trainings**

<!-- Table Styles -->
<style>
.custom-table {
  border-collapse: collapse;
}

.custom-table th,
.custom-table td {
  border: 1px solid #000;
  padding: 8px;
  text-align: center;
}

.custom-table th {
  background-color: #fe6e87;
  padding: 8px; /* Add padding specifically for the header cells */
}

</style>

<!-- Table -->
<table class="custom-table" style="empty-cells: show;">
  <thead>
    <tr>
      <th>MDA Practice</th>
      <th>LGA training <br> (n=14)</th>
      <th>Teacher training <br> (n=47)</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>One mebendazole tablet to be given to each child</td>
        ```{r one_meb, results='asis'}
query_one_meb <- "SELECT year, state, round, variable,
    'MEB' AS attributes,
    SUM(CASE WHEN attibutes = 'Covered in Detail' THEN value ELSE 0 END) +
    SUM(CASE WHEN attibutes = 'Covered Partially' THEN value ELSE 0 END) AS total_sum
FROM lga_obs
WHERE
    year = 2022
    AND state = 'Rivers'
    AND round = 'Overall'
    AND variable = 'One Tablet Per Child For Mebendazole/Albendazole'
    AND attibutes IN ('Covered Partially', 'Covered in Detail')
GROUP BY year, state, round, variable"

one_meb_data <- dbGetQuery(con, query_one_meb)

if (nrow(one_meb_data) == 0) {
  cat("<td>N/A</td>")
} else {
  for (i in 1:nrow(one_meb_data)) {
    cat("<td>")
    if (!is.na(one_meb_data$total_sum[i])) {
      cat(scales::percent(one_meb_data$total_sum[i]))
    } else {
      cat("N/A")
    }
    cat("</td>")
  }
}
```
      ```{r one_meb2, results='asis'}
query_one_meb2 <- "SELECT year, state, round, variable,
    'MEB' AS attributes,
    SUM(CASE WHEN attibutes = 'Covered Completely' THEN value ELSE 0 END) +
    SUM(CASE WHEN attibutes = 'Covered Partially' THEN value ELSE 0 END) AS total_sum
FROM tt_obs
WHERE
    year = 2022
    AND state = 'Rivers'
    AND round = 'Overall'
    AND variable = 'One Tablet of Mebendazole/Albendazole Per Child For STH:'
    AND attibutes IN ('Covered Partially', 'Covered Completely')
GROUP BY year, state, round, variable"

one_meb_data2 <- dbGetQuery(con, query_one_meb2)

if (nrow(one_meb_data2) == 0) {
  cat("<td>N/A</td>")
} else {
  for (i in 1:nrow(one_meb_data2)) {
    cat("<td>")
    if (!is.na(one_meb_data2$total_sum[i])) {
      cat(scales::percent(one_meb_data2$total_sum[i]))
    } else {
      cat("N/A")
    }
    cat("</td>")
  }
}
```
    </tr>
    <tr>
      <td>STH drug is mebendazole</td>
      ```{r drug_meb, results='asis'}
query_drug_meb <- "SELECT year, state, round, variable,
    'DRUG' AS attributes,
    SUM(CASE WHEN attibutes = 'Covered in Detail' THEN value ELSE 0 END) +
    SUM(CASE WHEN attibutes = 'Covered Partially' THEN value ELSE 0 END) AS total_sum
FROM lga_obs
WHERE
    year = 2022
    AND state = 'Rivers'
    AND round = 'Overall'
    AND variable = 'The drug used for STH will be Mebendazole/Albendazole'
    AND attibutes IN ('Covered Partially', 'Covered in Detail')
GROUP BY year, state, round, variable"

drug_meb_data <- dbGetQuery(con, query_drug_meb)

if (nrow(drug_meb_data) == 0) {
  cat("<td>N/A</td>")
} else {
  for (i in 1:nrow(drug_meb_data)) {
    cat("<td>")
    if (!is.na(drug_meb_data$total_sum[i])) {
      cat(scales::percent(drug_meb_data$total_sum[i]))
    } else {
      cat("N/A")
    }
    cat("</td>")
  }
}
```
       ```{r drug_meb2, results='asis'}
query_drug_meb2 <- "SELECT year, state, round, variable,
    'DRUG' AS attributes,
    SUM(CASE WHEN attibutes = 'Covered Completely' THEN value ELSE 0 END) +
    SUM(CASE WHEN attibutes = 'Covered Partially' THEN value ELSE 0 END) AS total_sum
FROM tt_obs
WHERE
    year = 2022
    AND state = 'Rivers'
    AND round = 'Overall'
    AND variable = 'The drug used for STH will be Mebendazole/Albendazole:'
    AND attibutes IN ('Covered Partially', 'Covered Completely')
GROUP BY year, state, round, variable"

drug_meb_data2 <- dbGetQuery(con, query_drug_meb2)

if (nrow(drug_meb_data2) == 0) {
  cat("<td>N/A</td>")
} else {
  for (i in 1:nrow(drug_meb_data2)) {
    cat("<td>")
    if (!is.na(drug_meb_data2$total_sum[i])) {
      cat(scales::percent(drug_meb_data2$total_sum[i]))
    } else {
      cat("N/A")
    }
    cat("</td>")
  }
}
```
    </tr>
    <tr>
      <td>Register enrolled children before deworming day and non-enrolled children on deworming day, before treatment</td>
       ```{r register_children, results='asis'}
query_register_children <- "SELECT year, state, round, variable,
    'REGISTER' AS attributes,
    SUM(CASE WHEN attibutes = 'Covered in Detail' THEN value ELSE 0 END) +
    SUM(CASE WHEN attibutes = 'Covered Partially' THEN value ELSE 0 END) AS total_sum
FROM lga_obs
WHERE
    year = 2022
    AND state = 'Rivers'
    AND round = 'Overall'
    AND variable = 'Names of all enrolled children need to be copied from the class register on to the treatment register before deworming day.'
    AND attibutes IN ('Covered Partially', 'Covered in Detail')
GROUP BY year, state, round, variable"

register_children_data <- dbGetQuery(con, query_register_children)

if (nrow(register_children_data) == 0) {
  cat("<td>N/A</td>")
} else {
  for (i in 1:nrow(register_children_data)) {
    cat("<td>")
    if (!is.na(register_children_data$total_sum[i])) {
      cat(scales::percent(register_children_data$total_sum[i]))
    } else {
      cat("N/A")
    }
    cat("</td>")
  }
}
```
      ```{r register_children2, results='asis'}
query_register_children2 <- "SELECT year, state, round, variable,
    'REGISTER' AS attributes,
    SUM(CASE WHEN attibutes = 'Covered Completely' THEN value ELSE 0 END) +
    SUM(CASE WHEN attibutes = 'Covered Partially' THEN value ELSE 0 END) AS total_sum
FROM tt_obs
WHERE
    year = 2022
    AND state = 'Rivers'
    AND round = 'Overall'
    AND variable = 'REGISTER CHILD'
    AND attibutes IN ('Covered Partially', 'Covered Completely')
GROUP BY year, state, round, variable"

register_children_data2 <- dbGetQuery(con, query_register_children2)

if (nrow(register_children_data2) == 0) {
  cat("<td>N/A</td>")
} else {
  for (i in 1:nrow(register_children_data2)) {
    cat("<td>")
    if (!is.na(register_children_data2$total_sum[i])) {
      cat(scales::percent(register_children_data2$total_sum[i]))
    } else {
      cat("N/A")
    }
    cat("</td>")
  }
}
```
    </tr>
    <tr>
      <td>Complete class level summary form as the child is treated</td>
      ```{r complete_form, results='asis'}
query_complete_form <- "SELECT year, state, round, variable,
    'COMPLETE' AS attributes,
    SUM(CASE WHEN attibutes = 'Covered in Detail' THEN value ELSE 0 END) +
    SUM(CASE WHEN attibutes = 'Covered Partially' THEN value ELSE 0 END) AS total_sum
FROM lga_obs
WHERE
    year = 2022
    AND state = 'Rivers'
    AND round = 'Overall'
    AND variable = 'Complete treatment register as child is treated.'
    AND attibutes IN ('Covered Partially', 'Covered in Detail')
GROUP BY year, state, round, variable"

complete_form_data <- dbGetQuery(con, query_complete_form)

if (nrow(complete_form_data) == 0) {
  cat("<td>N/A</td>")
} else {
  for (i in 1:nrow(complete_form_data)) {
    cat("<td>")
    if (!is.na(complete_form_data$total_sum[i])) {
      cat(scales::percent(complete_form_data$total_sum[i]))
    } else {
      cat("N/A")
    }
    cat("</td>")
  }
}
```
      ```{r complete_form2, results='asis'}
query_complete_form2 <- "SELECT year, state, round, variable,
    'COMPLETE' AS attributes,
    SUM(CASE WHEN attibutes = 'Covered Completely' THEN value ELSE 0 END) +
    SUM(CASE WHEN attibutes = 'Covered Partially' THEN value ELSE 0 END) AS total_sum
FROM tt_obs
WHERE
    year = 2022
    AND state = 'Rivers'
    AND round = 'Overall'
    AND variable = 'COMPLETE REGISTRATION'
    AND attibutes IN ('Covered Partially', 'Covered Completely')
GROUP BY year, state, round, variable"

complete_form_data2 <- dbGetQuery(con, query_complete_form2)

if (nrow(complete_form_data2) == 0) {
  cat("<td>N/A</td>")
} else {
  for (i in 1:nrow(complete_form_data2)) {
    cat("<td>")
    if (!is.na(complete_form_data2$total_sum[i])) {
      cat(scales::percent(complete_form_data2$total_sum[i]))
    } else {
      cat("N/A")
    }
    cat("</td>")
  }
}
```
    </tr>
    <tr>
      <td>Facilitate hand washing before treatment</td>
      ```{r hand_washing, results='asis'}
query_hand_washing <- "SELECT year, state, round, variable,
    'HANDWASHING' AS attributes,
    SUM(CASE WHEN attibutes = 'Covered in Detail' THEN value ELSE 0 END) +
    SUM(CASE WHEN attibutes = 'Covered Partially' THEN value ELSE 0 END) AS total_sum
FROM lga_obs
WHERE
    year = 2022
    AND state = 'Rivers'
    AND round = 'Overall'
    AND variable = 'Facilitate hand washing prior to treatment'
    AND attibutes IN ('Covered Partially', 'Covered in Detail')
GROUP BY year, state, round, variable"

hand_washing_data <- dbGetQuery(con, query_hand_washing)

if (nrow(hand_washing_data) == 0) {
  cat("<td>N/A</td>")
} else {
  for (i in 1:nrow(hand_washing_data)) {
    cat("<td>")
    if (!is.na(hand_washing_data$total_sum[i])) {
      cat(scales::percent(hand_washing_data$total_sum[i]))
    } else {
      cat("N/A")
    }
    cat("</td>")
  }
}
```
    ```{r hand_washing2, results='asis'}
query_hand_washing2 <- "SELECT year, state, round, variable,
    'HANDWASHING' AS attributes,
    SUM(CASE WHEN attibutes = 'Covered Completely' THEN value ELSE 0 END) +
    SUM(CASE WHEN attibutes = 'Covered Partially' THEN value ELSE 0 END) AS total_sum
FROM tt_obs
WHERE
    year = 2022
    AND state = 'Rivers'
    AND round = 'Overall'
    AND variable = 'HANDWASHING'
    AND attibutes IN ('Covered Partially', 'Covered Completely')
GROUP BY year, state, round, variable"

hand_washing_data2 <- dbGetQuery(con, query_hand_washing2)

if (nrow(hand_washing_data2) == 0) {
  cat("<td>N/A</td>")
} else {
  for (i in 1:nrow(hand_washing_data2)) {
    cat("<td>")
    if (!is.na(hand_washing_data2$total_sum[i])) {
      cat(scales::percent(hand_washing_data2$total_sum[i]))
    } else {
      cat("N/A")
    }
    cat("</td>")
  }
}
```
    </tr>
    <tr>
      <td>Observe the child’s mouth to see if each child chews and swallows the tablet</td>
      ```{r check_mouth, results='asis'}
query_check_mouth <- "SELECT year, state, round, variable,
    'CHECKMOUTH' AS attributes,
    SUM(CASE WHEN attibutes = 'Covered in Detail' THEN value ELSE 0 END) +
    SUM(CASE WHEN attibutes = 'Covered Partially' THEN value ELSE 0 END) AS total_sum
FROM lga_obs
WHERE
    year = 2022
    AND state = 'Rivers'
    AND round = 'Overall'
    AND variable = 'Check child’s mouth to make sure that each child chews and swallows the tablet'
    AND attibutes IN ('Covered Partially', 'Covered in Detail')
GROUP BY year, state, round, variable"

check_mouth_data <- dbGetQuery(con, query_check_mouth)

if (nrow(check_mouth_data) == 0) {
  cat("<td>N/A</td>")
} else {
  for (i in 1:nrow(check_mouth_data)) {
    cat("<td>")
    if (!is.na(check_mouth_data$total_sum[i])) {
      cat(scales::percent(check_mouth_data$total_sum[i]))
    } else {
      cat("N/A")
    }
    cat("</td>")
  }
}
```
      ```{r check_mouth2, results='asis'}
query_check_mouth2 <- "SELECT year, state, round, variable,
    'CHECKMOUTH' AS attributes,
    SUM(CASE WHEN attibutes = 'Covered Completely' THEN value ELSE 0 END) +
    SUM(CASE WHEN attibutes = 'Covered Partially' THEN value ELSE 0 END) AS total_sum
FROM tt_obs
WHERE
    year = 2022
    AND state = 'Rivers'
    AND round = 'Overall'
    AND variable = 'CHECK MOUTH'
    AND attibutes IN ('Covered Partially', 'Covered Completely')
GROUP BY year, state, round, variable"

check_mouth_data2 <- dbGetQuery(con, query_check_mouth2)

if (nrow(check_mouth_data2) == 0) {
  cat("<td>N/A</td>")
} else {
  for (i in 1:nrow(check_mouth_data2)) {
    cat("<td>")
    if (!is.na(check_mouth_data2$total_sum[i])) {
      cat(scales::percent(check_mouth_data2$total_sum[i]))
    } else {
      cat("N/A")
    }
    cat("</td>")
  }
}
```
    </tr>
    <tr>
      <td>Under no circumstances should a child be forced to swallow the medicine</td>
      ```{r forced_swallow, results='asis'}
query_forced_swallow <- "SELECT year, state, round, variable,
    'FORCECHILD' AS attributes,
    SUM(CASE WHEN attibutes = 'Covered in Detail' THEN value ELSE 0 END) +
    SUM(CASE WHEN attibutes = 'Covered Partially' THEN value ELSE 0 END) AS total_sum
FROM lga_obs
WHERE
    year = 2023
    AND state = 'Rivers'
    AND round = 'Round 1'
    AND variable = 'Under no circumstances should a child be forced to swallow the medicine'
    AND attibutes IN ('Covered Partially', 'Covered in Detail')
GROUP BY year, state, round, variable"

forced_swallow_data <- dbGetQuery(con, query_forced_swallow)

if (nrow(forced_swallow_data) == 0) {
  cat("<td>N/A</td>")
} else {
  for (i in 1:nrow(forced_swallow_data)) {
    cat("<td>")
    if (!is.na(forced_swallow_data$total_sum[i])) {
      cat(scales::percent(forced_swallow_data$total_sum[i]))
    } else {
      cat("N/A")
    }
    cat("</td>")
  }
}
```
      ```{r forced_swallow2, results='asis'}
query_forced_swallow2 <- "SELECT year, state, round, variable,
    'FORCECHILD' AS attributes,
    SUM(CASE WHEN attibutes = 'Covered Completely' THEN value ELSE 0 END) +
    SUM(CASE WHEN attibutes = 'Covered Partially' THEN value ELSE 0 END) AS total_sum
FROM tt_obs
WHERE
    year = 2022
    AND state = 'Rivers'
    AND round = 'Overall'
    AND variable = 'DO NOT FORCE A CHILD.'
    AND attibutes IN ('Covered Partially', 'Covered Completely')
GROUP BY year, state, round, variable"

forced_swallow_data2 <- dbGetQuery(con, query_forced_swallow2)

if (nrow(forced_swallow_data2) == 0) {
  cat("<td>N/A</td>")
} else {
  for (i in 1:nrow(forced_swallow_data2)) {
    cat("<td>")
    if (!is.na(forced_swallow_data2$total_sum[i])) {
      cat(scales::percent(forced_swallow_data2$total_sum[i]))
    } else {
      cat("N/A")
    }
    cat("</td>")
  }
}
```
    </tr>
    <tr>
      <td>Under the program, all drugs are free, safe and effective</td>
      ```{r drug_safe, results='asis'}
query_drug_safe <- "SELECT year, state, round, variable,
    'SAFEDRUG' AS attributes,
    SUM(CASE WHEN attibutes = 'Covered in Detail' THEN value ELSE 0 END) +
    SUM(CASE WHEN attibutes = 'Covered Partially' THEN value ELSE 0 END) AS total_sum
FROM lga_obs
WHERE
    year = 2022
    AND state = 'Rivers'
    AND round = 'Overall'
    AND variable = 'Under the program, all drugs are free, safe and effective:'
    AND attibutes IN ('Covered Partially', 'Covered in Detail')
GROUP BY year, state, round, variable"

drug_safe_data <- dbGetQuery(con, query_drug_safe)

if (nrow(drug_safe_data) == 0) {
  cat("<td>N/A</td>")
} else {
  for (i in 1:nrow(drug_safe_data)) {
    cat("<td>")
    if (!is.na(drug_safe_data$total_sum[i])) {
      cat(scales::percent(drug_safe_data$total_sum[i]))
    } else {
      cat("N/A")
    }
    cat("</td>")
  }
}
```
      ```{r drug_safe2, results='asis'}
query_drug_safe2 <- "SELECT year, state, round, variable,
    'SAFEDRUG' AS attributes,
    SUM(CASE WHEN attibutes = 'Covered Completely' THEN value ELSE 0 END) +
    SUM(CASE WHEN attibutes = 'Covered Partially' THEN value ELSE 0 END) AS total_sum
FROM tt_obs
WHERE
    year = 2022
    AND state = 'Rivers'
    AND round = 'Overall'
    AND variable = 'Under the program, all drugs are free, safe and effective:'
    AND attibutes IN ('Covered Partially', 'Covered Completely')
GROUP BY year, state, round, variable"

drug_safe_data2 <- dbGetQuery(con, query_drug_safe2)

if (nrow(drug_safe_data2) == 0) {
  cat("<td>N/A</td>")
} else {
  for (i in 1:nrow(drug_safe_data2)) {
    cat("<td>")
    if (!is.na(drug_safe_data2$total_sum[i])) {
      cat(scales::percent(drug_safe_data2$total_sum[i]))
    } else {
      cat("N/A")
    }
    cat("</td>")
  }
}
```
    </tr>
    <tr>
      <td>Drugs must be stored in a clean, safe, dry and cool location</td>
      ```{r store_safe, results='asis'}
query_store_safe <- "SELECT year, state, round, variable,
    'STORESAFE' AS attributes,
    SUM(CASE WHEN attibutes = 'Covered in Detail' THEN value ELSE 0 END) +
    SUM(CASE WHEN attibutes = 'Covered Partially' THEN value ELSE 0 END) AS total_sum
FROM lga_obs
WHERE
    year = 2022
    AND state = 'Rivers'
    AND round = 'Overall'
    AND variable = 'Drugs must be stored in a clean, safe, dry and cool location:'
    AND attibutes IN ('Covered Partially', 'Covered in Detail')
GROUP BY year, state, round, variable"

store_safe_data <- dbGetQuery(con, query_store_safe)

if (nrow(store_safe_data) == 0) {
  cat("<td>N/A</td>")
} else {
  for (i in 1:nrow(store_safe_data)) {
    cat("<td>")
    if (!is.na(store_safe_data$total_sum[i])) {
      cat(scales::percent(store_safe_data$total_sum[i]))
    } else {
      cat("N/A")
    }
    cat("</td>")
  }
}
```
      ```{r store_safe2, results='asis'}
query_store_safe2 <- "SELECT year, state, round, variable,
    'STORESAFE' AS attributes,
    SUM(CASE WHEN attibutes = 'Covered Completely' THEN value ELSE 0 END) +
    SUM(CASE WHEN attibutes = 'Covered Partially' THEN value ELSE 0 END) AS total_sum
FROM tt_obs
WHERE
    year = 2022
    AND state = 'Rivers'
    AND round = 'Overall'
    AND variable = 'Drugs must be stored in a clean, safe, dry and cool location:'
    AND attibutes IN ('Covered Partially', 'Covered Completely')
GROUP BY year, state, round, variable"

store_safe_data2 <- dbGetQuery(con, query_store_safe2)

if (nrow(store_safe_data2) == 0) {
  cat("<td>N/A</td>")
} else {
  for (i in 1:nrow(store_safe_data2)) {
    cat("<td>")
    if (!is.na(store_safe_data2$total_sum[i])) {
      cat(scales::percent(store_safe_data2$total_sum[i]))
    } else {
      cat("N/A")
    }
    cat("</td>")
  }
}
```
    </tr>
  </tbody>
</table>

On deworming day, every member of the deworming team (100%) knew the correct dosage, and that the drug used for treatment was mebendazole - **Figure 11.** 

##### **Figure 11: Deworming team knowledge of drugs and dosage on deworming day (n=60)** 

```{r figure11, echo=FALSE}

library(ggplot2)
library(gridExtra)
library(stringr)

# sql query to get data
sql_query <- "SELECT * FROM dd_main
WHERE year = 2022
AND state = 'Rivers'
AND round = 'Overall'
AND variable IN ('What drug was used for the treatment of STH?','What is the dosage for the treatment of STH?')
AND attributes IN ('Mebendazole/Albendazole','One tablet per child')"

data <- dbGetQuery(con, sql_query)

# Mapping original variable names to desired names
variable_mapping <- c('One tablet per child' = 'STH dosage is one tablet per child',
                      'Mebendazole/Albendazole' = 'STH drug is mebendazole')

# Creating a new variable with the desired names
data$variable_mapped <- variable_mapping[data$attributes]

# Use reorder to arrange bars based on value
data$variable_mapped <- reorder(data$variable_mapped, data$value)

# Plotting
plot <- ggplot(data, aes(x = variable_mapped, y = value, fill = variable_mapped)) +
     geom_bar(stat = "identity", position = "identity", color = "white", fill = "#fe6e87") +
     geom_text(aes(label = scales::percent(value), y = value, group = variable_mapped), 
               position = position_stack(vjust = 0.5), size = 3) +
     labs(title = NULL, x = NULL, y = NULL) +
     coord_flip() +
     theme_minimal() +
     theme(axis.text.x = element_blank()) +  
    scale_x_discrete(labels = function(x) str_wrap(x, width = 20))

print(plot)

```

#### <span style="color:#fe6e87;">Topic 7: Side Effects</span>

Side effects are potential outcomes of any treatment that may or may not be directly related to the treatment being provided. To ensure that teachers were effectively equipped to handle such cases, trainers covered information on possible side effects and how to handle them in 98% (100% in round one and 94% in round two) of teacher training sessions and all (100% - in each round) in LGA trainings. Coverage of these side effects and teachers’ pre- and post-training knowledge is shown in - Figure 12. While post-training scores for all side effects increased from pre-training levels, the majority of participants recalled only two side effects post-training. Additional indicators relating to severe adverse effects (SAEs) can be found in - **Table 5**, including the teacher's and FLHF's knowledge of side effects and SAEs on deworming day.

##### **Figure 12: Messages shared about side effects, participants’ pre- and post-training knowledge and FLHF on deworming day** 

```{r figure12, echo=FALSE, fig.height=6, fig.width = 8}

library(ggplot2)
library(gridExtra)
library(stringr)

# sql query messages covered under side effects
sql_query <- "SELECT * FROM tt_obs
WHERE year = 2022
AND state = 'Rivers'
AND round = 'Overall'
AND variable = 'According to the trainers, the potential side effects of receiving deworming treatment may include:'
AND attibutes IN ('Nausea', 'Abdominal Pain', 'Fatigue', 'Vomiting', 'Diarrhoea', 'Malaise', 'Fainting')"

data <- dbGetQuery(con, sql_query)

# Use reorder to arrange bars from smallest to highest
data$attibutes <- reorder(data$attibutes, data$value)

# sql query pre & post knowledge
sql_query2 <- "SELECT * FROM ttci_prepost
WHERE year = 2022
AND state = 'Rivers'
AND round = 'Overall'
AND variable = 'What mild side effects are considered normal while treating for STH?'
AND attibutes IN ('Headache', 'Nausea', 'Abdominal discomfort', 'Vomiting', 'Fainting', 'Dizziness', 'Fatigue','Diarrhoea')"

data2 <- dbGetQuery(con, sql_query2)

# plotting
plot <- ggplot(data, aes(x = attibutes, y = value, fill = attibutes)) +
     geom_bar(stat = "identity", position = "identity", color = "white", fill = "#fe6e87") +
     geom_text(aes(label = scales::percent(value), y = value, group = attibutes), 
               position = position_stack(vjust = 0.5), size = 3) +
     labs(title = "Messages covered under\nside effects (n=47)", x = NULL, y = NULL) +
     coord_flip() +
     theme_minimal() +
     theme(axis.text.x = element_blank()) +  
    scale_x_discrete(labels = function(x) str_wrap(x, width = 20))

plot2 <- ggplot(data2, aes(x = sourcefile, y = value, fill = sourcefile)) +
     geom_bar(stat = "identity", position = "dodge", color = "white") +
     facet_wrap(~attibutes, scales = 'free_y', ncol = 1) +
     labs(title = "Pre- and post- knowledge", x = NULL, y = NULL) +
     coord_flip() +
     theme_minimal() +
     theme(axis.text.x = element_blank()) +  # Remove x-axis text
     geom_text(aes(label = scales::percent(value), group = attibutes),
               position = position_dodge(width = 0.8),  
               vjust = 0.5, size = 3) +  
     scale_fill_manual(values = c("#fe6e87", "#D3D3D3"), name = NULL)+
  guides(fill = guide_legend(override.aes = list(title = NULL)))+
  scale_x_discrete(labels = function(x) str_wrap(x, width = 20))

grid.arrange(plot, plot2, ncol = 2)
```

/* figure 2 */

##### **Table 5: Coverage and retention of knowledge of side effects in LGA and teacher trainings and on deworming day**

<!-- Table Styles -->
<style>
.custom-table {
  border-collapse: collapse;
}

.custom-table th,
.custom-table td {
  border: 1px solid #000;
  padding: 8px;
  text-align: center;
}

.custom-table th {
  background-color: #fe6e87;
}
</style>

<!-- Table -->
<table class="custom-table">
  <thead>
    <tr>
      <th></th>
      <th>Year 6, Round 2</th>
      <th>Year 6, Round 1</th>
      <th>Year 5, Round 1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td colspan="4" class="left-align"><strong>Topics covered during training</strong></td>
    </tr>
    <tr>
      <td>Steps to be taken in cases of SAEs at LGA trainings</td>
      <td>100%</td>
      <td>88%</td>
      <td>100%</td>
    </tr>
    <tr>
      <td>Steps to be taken in cases of SAEs at teacher trainings</td>
      <td>94%</td>
      <td>93%</td>
      <td>86%</td>
    </tr>
    <tr>
      <td>Side effects in LGA trainings</td>
      <td>100%</td>
      <td>100%</td>
      <td>100%</td>
    </tr>
    <tr>
      <td>Side effects in teacher trainings</td>
      <td>94%</td>
      <td>100%</td>
      <td>89%</td>
    </tr>
    <tr>
      <td colspan="4" class="left-align"><strong>LGA and Teacher training</strong></td>
    </tr>
    <tr>
      <td>LGA training attendees that could cite at least one side effect in post-training interviews</td>
      <td>96%</td>
      <td>100%</td>
      <td>100%</td>
    </tr>
    <tr>
      <td>Teacher training attendees that could cite at least one side effect in post-training interviews</td>
      <td>96%</td>
      <td>97%</td>
      <td>97%</td>
    </tr>
    <tr>
      <td>Teachers that reported having FLHF staff contact information in post-training interviews</td>
      <td>79%</td>
      <td>59%</td>
      <td>62%</td>
    </tr>
    <tr>
      <td colspan="4" class="left-align"><strong>Deworming day</strong></td>
    </tr>
    <tr>
      <td>FLHF staff could cite at least one side effect</td>
      <td>100%</td>
      <td>100%</td>
      <td>100%</td>
    </tr>
    <tr>
      <td>FLHF staff mentioned the correct steps to take in case of SAE</td>
      <td>29%</td>
      <td>36%</td>
      <td>40%</td>
    </tr>
  </tbody>
</table>


```{r}

```

